<?xml version="1.0" encoding="UTF-8"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="crackvac">
    <!-- materials -->
    <material name="grey">
       <color rgba="0.7 0.7 0.7 1.0"/> 
    </material>
    <material name="blue">
       <color rgba="0 0 0.9 1.0"/> 
    </material>
    <material name="black">
       <color rgba="0 0 0 1.0"/> 
    </material>

    <!-- macros -->
    <link name="dummy_link">
        <collision>
            <geometry>
                <box size="0.4 0.4 0.2"/> <!-- length unit: m-->
            </geometry>
        </collision>
        <inertial>
            <mass value="7.0"/> <!-- mass unit: kg-->
            <inertia ixx="0.187" ixy="0.0" ixz="0.0" iyy="0.117" iyz="0.0" izz="0.117"/>
        </inertial>
    </link>
    <joint name="base_fixedpoint" type="fixed">
       <parent link="base_link"/>
       <child link="dummy_link"/>
    </joint>

    <xacro:macro name="chassis">
        <link name="base_link">
            <visual>
                <geometry>
                    <box size="0.4 0.4 0.2"/> 
                </geometry> 
                <origin xyz="0.0 0.0 0.1" rpy="0.0 0.0 0.0"/>
                <material name="grey"/>
            </visual>
        </link>    
    </xacro:macro>
    
    <xacro:macro name="swerve_module" params="name mount">
        <link name="${name}_steer">
            <visual>
            <geometry>
                    <cylinder radius="0.05" length="0.01"/> 
            </geometry> 
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <material name="blue"/>
            </visual>
        </link>

        <link name="${name}_wheel">
            <visual>
                <geometry>
                    <cylinder radius="0.04" length="0.03"/>
                </geometry>
                <origin xyz="0 0 0" rpy="1.57 0 0"/>
                <material name="black"/>
            </visual>
            <collision>
                <geometry>
                    <cylinder radius="0.04" length="0.03"/>
                </geometry>
                <origin xyz="0 0 0" rpy="1.57 0 0"/>
            </collision>
            <inertial>
                <mass value="0.079"/>
                <inertia ixx="0.002291" ixy="0.0" ixz="0.0" iyy="0.002291" iyz="0.0" izz="0.0000632"/>
            </inertial>
        </link>

        <joint name="${name}_steer_joint" type="continuous">
            <parent link="base_link"/>
            <child link="${name}_steer"/>
            <origin xyz="${mount}" rpy="0 0 0"/> 
            <axis xyz="0 0 1"/>
        </joint>
        <joint name="${name}_wheel_joint" type="continuous">
            <parent link="${name}_steer"/>
            <child link="${name}_wheel"/>
            <origin xyz="0 0 0" rpy="0.0 0.0 0.0"/>
            <axis xyz="0 1 0"/>
        </joint>
    </xacro:macro>

    <!-- implementation -->
    <xacro:chassis />
    <xacro:swerve_module name="fl" mount="-0.15 0.15 0.0"/>    
    <xacro:swerve_module name="fr" mount="0.15 0.15 0.0"/>    
    <xacro:swerve_module name="bl" mount="-0.15 -0.15 0.0"/>    
    <xacro:swerve_module name="br" mount="0.15 -0.15 0.0"/>    
</robot>